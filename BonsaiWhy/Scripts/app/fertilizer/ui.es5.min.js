"use strict";(function(n){typeof define=="function"&&define.amd?define(["fertilizercalculator","fertilizerdata","molarmass"],n):FertilizerUI=n(FertilizerCalculator,FertilizerData,MolarMass)})(function(n,t,i){var r=function(n,t,i){for(var r=0;r<n.length;r++)t.call(i,n[r],r,n)},f=function(n){n.innerHTML='<div class="loading">Loading...<\/div>'},e=function(n){var t=n.querySelector(".loading");n.removeChild(t)},o=function(n,t,i){var r=document.createElement("div"),u,f;return r.className="row",u=document.createElement("span"),u.innerHTML=n+": ",u.className="cell",f=document.createElement("span"),f.innerHTML=t.toLocaleString()+i,f.className="cell",r.appendChild(u),r.appendChild(f),r},u=function(n,t){var r={name:n,value:t},i=document.createElement("button");return i.className="fertilizer active",i.innerHTML=n,i.value=n,i.title="Remove "+n,i.dataset.fertilizer=JSON.stringify(r),i.addEventListener("click",function(){this.classList.toggle("active")}),i},s=function(){var f=document.getElementById("fertilizer-options"),n=document.getElementById("fertilizer-formula").value,t,r;n&&(t=i.CalculateMM(n),r=u(n,t),f.appendChild(r))},h=function(){var f=document.getElementById("fertilizer-options"),n=document.getElementById("npk-formula").value,t,r;n&&(t=i.CalculateNPK(n),r=u(n,t),f.appendChild(r))},c=function(n,t){var i=document.createElement("div"),r,f,u,e,o;return i.className="row goal",r=document.createElement("label"),r.className="cell element active",r.innerHTML=n,r.addEventListener("click",function(){this.classList.toggle("active")}),f=document.createElement("div"),f.className="cell",u=document.createElement("input"),u.type="text",u.id="goal"+n,u.value=t,f.appendChild(u),e=document.createElement("output"),e.className="cell",e.id="output"+n,o=document.createElement("output"),o.className="cell",o.id="error"+n,i.appendChild(r),i.appendChild(f),i.appendChild(e),i.appendChild(o),i},l=function(){var i=document.getElementById("fertilizer-goals"),n=document.getElementById("goal-element").value,t;n&&(t=c(n,0),i.appendChild(t))},a=function(){var n=[];return r(document.querySelectorAll(".fertilizer.active"),function(t){var i=JSON.parse(t.dataset.fertilizer);n.push(i)}),n},v=function(){return parseFloat(document.getElementById("volumeInput").value)},y=function(){var n=[];return r(document.querySelectorAll(".goal .element.active"),function(t){n.push({name:t.innerHTML})}),n},p=function(n,t){var i=[];return n.forEach(function(n){var r=[];t.forEach(function(t){r.push(t.value.hasOwnProperty(n.name)?t.value[n.name]:0)});i.push(r)}),i},w=function(n,t){var i=[];return n.forEach(function(n,r,u){var f=parseFloat(document.getElementById("goal"+n.name).value)||0;u[r].value=f;i.push(f*t)}),i},b=function(n,t,i,u){r(document.querySelectorAll(".goal output"),function(n){n.innerHTML=0});n.forEach(function(n){var f=0,r;i.forEach(function(i,r){f+=i*(t[r].value.hasOwnProperty(n.name)?t[r].value[n.name]:0)});r=f/u;document.getElementById("output"+n.name).innerHTML=Math.round(r);document.getElementById("error"+n.name).innerHTML=Math.round(r-n.value)})},k=function(n,t){var i=document.getElementById("fertilizer-amounts");t.forEach(function(t,r){var u=o(n[r].name,Math.round(t),"mg");i.appendChild(u)})},d=function(n,t,i){var f=document.getElementById("fertilizer-amounts"),r=0,u;t.forEach(function(n){r+=n});u=o("Total PPM",Math.round(r/i),"ppm");f.appendChild(u)},g=function(){var o=document.getElementById("fertilizer-amounts");f(o);var t=a(),i=v(),r=y(),s=p(r,t),h=w(r,i),u=n.Calculate(s,h);b(r,t,u,i);k(t,u);d(t,u,i);e(o)},nt=function(){f(document.getElementById("fertilizer-amounts"));setTimeout(g,100)},tt=function(){var n=document.getElementById("fertilizer-options");t.forEach(function(t){var r=i.CalculateMM(t.formula),f=u(t.name,r);n.appendChild(f)});e(n)},it=function(){var n=document.getElementById("fertilizer-goals");[{name:"N",value:211},{name:"P",value:46},{name:"K",value:263},{name:"Ca",value:132},{name:"Mg",value:20},{name:"S",value:13}].forEach(function(t){var i=c(t.name,t.value);n.appendChild(i)})},rt=function(){document.getElementById("fertilizer-add").addEventListener("click",s);document.getElementById("fertilizer-formula").addEventListener("keyup",function(n){n.preventDefault();n.keyCode==13&&s()});document.getElementById("npk-add").addEventListener("click",h);document.getElementById("npk-formula").addEventListener("keyup",function(n){n.preventDefault();n.keyCode==13&&h()});document.getElementById("goal-add").addEventListener("click",l);document.getElementById("goal-element").addEventListener("keyup",function(n){n.preventDefault();n.keyCode==13&&l()});document.getElementById("fertilizer-submit").addEventListener("click",nt)},ut=function(){tt();it();rt()};return{Init:ut}});